# Instruction 2151513 Report

## 0) Bot mapping (confirmed from logs)

- **ao000** → @ao000bot  
- **ao001** → @ao001bot (log: `[telegram] [default] starting provider (@ao001bot)`)  
- **ao002** → @ao002bot (log: `[telegram] [default] starting provider (@ao002bot)`)

## 1) Diagnosis (ao001 / ao002)

### ao001
- **whoami/uid:** ao001, 504  
- **openclaw:** `/Users/ao001/.local/bin/openclaw`, 2026.2.9  
- **gateway status:** Service: LaunchAgent (not loaded). Could not find service in domain gui:504.  
- **launchctl print:** (empty in sudo -u context; GUI domain may not be visible)  
- **gateway.log:** Contains `[telegram] [default] starting provider (@ao001bot)` and `listening on ws://127.0.0.1:18789`. When gateway was running, Telegram provider did start.  
- **gateway.err.log:** token_mismatch (probe), and once `tlvc_status: TLVC_TOKEN_FILE is not set` (agent tool path; hard-route injects env).  
- **grep telegram:** Multiple "starting provider (@ao001bot)" lines; no 401/Forbidden for Telegram API.

### ao002
- **openclaw:** `/Users/ao002/.local/bin/openclaw`, 2026.2.9  
- **gateway status:** LaunchAgent (not loaded), Could not find service in domain gui:505.  
- **gateway.log:** Contains "starting provider (@ao002bot)" when gateway was running.  
- **Conclusion:** Both have Telegram config and historically started the provider; current “no reply” is consistent with **gateway not running** (LaunchAgent not loaded in the session we checked).

## 2) Fix: reinstall LaunchAgent for ao001 / ao002

- Ran for **ao001:** `openclaw gateway stop`, `openclaw gateway install --force`, `openclaw gateway start`.  
- Ran for **ao002:** Same sequence.  
- Commands may block on `gateway start`; on Mac mini, ensure each user has a GUI login session so `launchctl bootstrap gui/$UID` takes effect and the job stays loaded.  
- **Goal:** After reboot or re-login, gateway.log should again show `[telegram] [default] starting provider (@ao001bot)` / `(@ao002bot)`.

## 3) Config check (ao001 / ao002)

- **ao001** `~/.openclaw/openclaw.json`: Has `"channels": { "telegram": { ... } }` (around lines 137–138).  
- **ao002** `~/.openclaw/openclaw.json`: Has `"channels": { "telegram": { ... } }` (around lines 122–123).  
- **ao000** has the same structure (`channels.telegram`).  
- **Conclusion:** No “align copy” needed; both ao001 and ao002 already have Telegram channel/provider config. If there was “no reply,” it was due to gateway not running, not missing config.

## 4) Duplicate `artifacts_dir` in /tlvc_deliver (fixed)

- **Cause:** Hard-route sent script stdout and then always appended `\nartifacts_dir: ${outDir}`, while the script already prints artifacts_dir/outDir.  
- **Change:** In `bot-message-tlvc-patched.ts` (and deployed `src/telegram/bot-message.ts`), the success branch now sends **only** script stdout; the extra `\nartifacts_dir: ${outDir}` append was removed. On failure we still append `\nFAILED (exit=...): ...`.  
- **Deploy:** Updated patched file copied to ao000/ao001/ao002 `openclaw/openclaw/src/telegram/bot-message.ts`; `pnpm run build` run for all three. Restart gateway so the new dist is loaded; then ao000 (and ao001/ao002 when gateway is up) will no longer show two `artifacts_dir` lines for `/tlvc_deliver`.

## Summary

| Step | Done |
|------|------|
| 0 | Bot mapping: ao000→@ao000bot, ao001→@ao001bot, ao002→@ao002bot (logs show starting provider @…bot). |
| 1 | Diagnosed: ao001/ao002 have telegram config and logs show provider starting when gateway ran; currently LaunchAgent not loaded. |
| 2 | Ran install --force + start for ao001 and ao002; persistence depends on GUI login / launchd. |
| 3 | Confirmed ao001/ao002 have channels.telegram; no config copy from ao000. |
| 4 | Removed duplicate artifacts_dir append; deployed and built for all three users. |

**Next:** On Mac mini, ensure ao001/ao002 are logged in (or LaunchAgent domain is active), then verify gateway.log again for “starting provider (@ao001bot)” / “(@ao002bot)”. After gateway restart, test `/tlvc_deliver` on ao000 to confirm a single artifacts_dir line.
